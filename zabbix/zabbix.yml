- hosts: ubuntu-masternode01
  become: yes
  become_user: ubuntu
  tasks:
    - name: create namespace
      shell: "kubectl apply -f https://raw.githubusercontent.com/jpmenega/kubernetes/main/zabbix/kube-zabbix-ns.yaml > zabbix-namespace.txt"
      args:
        chdir: $HOME
        creates: zabbix-namespace.txt

    - name: create glusterfs-endpoints
      shell: "kubectl apply -f https://raw.githubusercontent.com/jpmenega/kubernetes/main/zabbix/glusterfs-endpoints.yaml > zabbix-gluster-endpoints"
      args:
        chdir: $HOME
        creates: zabbix-gluster-endpoints.txt

    - name: create glusterfs-client service
      shell: "kubectl apply -f https://raw.githubusercontent.com/jpmenega/kubernetes/main/zabbix/glusterfs-service.yaml > zabbix-gluster-service.txt"
      args:
        chdir: $HOME
        creates: zabbix-gluster-service.txt

    - name: create database pod
      shell: "kubectl apply -f https://raw.githubusercontent.com/jpmenega/kubernetes/main/zabbix/kube-database.yaml > zabbix-database.txt"
      args:
        chdir: $HOME
        creates: zabbix-database.txt
